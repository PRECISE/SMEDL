
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>RabbitMQ Transport &#8212; SMEDL  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ROS Transport" href="ros.html" />
    <link rel="prev" title="Essential API" href="api.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">SMEDL</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../language/index.html">SMEDL Specification Language</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">SMEDL Programming Interface</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="api.html">Essential API</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">RabbitMQ Transport</a></li>
<li class="toctree-l2"><a class="reference internal" href="ros.html">ROS Transport</a></li>
<li class="toctree-l2"><a class="reference internal" href="full_api.html">Full API</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">SMEDL Programming Interface</a><ul>
      <li>Previous: <a href="api.html" title="previous chapter">Essential API</a></li>
      <li>Next: <a href="ros.html" title="next chapter">ROS Transport</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="rabbitmq-transport">
<h1>RabbitMQ Transport<a class="headerlink" href="#rabbitmq-transport" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Many file names and identifiers in this API contain placeholders for event,
monitor, and synchronous set names. These placeholders are marked by the use
of ALLCAPS.</p>
</div>
<p>This asynchronous transport sends events as messages through a RabbitMQ server.
Asynchronous events are only sent or received during a call to
<a class="reference internal" href="api.html#c.run_manager" title="run_manager"><code class="xref c c-func docutils literal notranslate"><span class="pre">run_manager()</span></code></a>, so the target program should ensure this is called from
time to time.</p>
<p><strong>This transport also works well for pure synchronous monitor systems, where
all monitors and the “pedl” keyword are in the same synchronous set.</strong> In that
case, no RabbitMQ code is actually generated.</p>
<section id="rabbitmq-configuration">
<h2>RabbitMQ Configuration<a class="headerlink" href="#rabbitmq-configuration" title="Permalink to this headline">¶</a></h2>
<p>A <code class="docutils literal notranslate"><span class="pre">SYSNAME.cfg</span></code> file is generated along with the rest of the code for the
monitors. This contains the configuration options the monitors will use for
RabbitMQ. It must be located in the current directory when the monitors are
started. If it cannot be found or opened, default configuration is used
instead.</p>
<p>These are the keys that can be set:</p>
<dl class="simple">
<dt>“hostname”</dt><dd><p>Hostname or IP address for the RabbitMQ server. Default: “localhost”</p>
</dd>
<dt>“port”</dt><dd><p>Port number for the RabbitMQ server. Default: 5672</p>
</dd>
<dt>“username”</dt><dd><p>Username to log in to the RabbitMQ server with. Default: “guest”</p>
</dd>
<dt>“password”</dt><dd><p>Password to log in to the RabbitMQ server with. Default: “guest”</p>
</dd>
<dt>“exchange”</dt><dd><p>Exchange name to use. Default: “smedl.SYSNAME”</p>
</dd>
<dt>“vhost”</dt><dd><p>Vhost to use. Default: “/”</p>
</dd>
</dl>
</section>
<section id="message-format">
<h2>Message Format<a class="headerlink" href="#message-format" title="Permalink to this headline">¶</a></h2>
<p>Normally, the synchronous set to which PEDL events belong must be linked
against the target program. (Usage as a shared library should also be possible,
but the automatically generated Makefile would have to be modified.) When PEDL
events are all placed in their own synchronous set (the default when no syncset
contains the <code class="docutils literal notranslate"><span class="pre">pedl</span></code>, <code class="docutils literal notranslate"><span class="pre">imported</span></code>, or <code class="docutils literal notranslate"><span class="pre">exported</span></code> keywords), there is an
alternative option: Have the target program emit and receive RabbitMQ messages
directly.</p>
<p>SMEDL uses the “topic” exchange type, with routing keys that look like
<code class="docutils literal notranslate"><span class="pre">&lt;channel_name&gt;.&lt;event_name&gt;</span></code> for PEDL events emitted from the target
program and <code class="docutils literal notranslate"><span class="pre">&lt;channel_name&gt;.&lt;monitor_name&gt;.&lt;event_name&gt;</span></code> for events emitted
from monitors.</p>
<p>RabbitMQ messages can have certain properties attached to them. SMEDL uses the
following message properties:</p>
<dl class="simple">
<dt><strong>content-type</strong></dt><dd><p>Optional, but recommended. Set to <code class="docutils literal notranslate"><span class="pre">application/json</span></code>.</p>
</dd>
<dt><strong>correlation-id</strong></dt><dd><p>Optional. If set on an imported event, it will be copied to any exported
events that result. Can be used to link exported events to their cause.</p>
</dd>
<dt><strong>type</strong></dt><dd><p>Optional, but highly recommended. If used, it must be set to
<code class="docutils literal notranslate"><span class="pre">smedl-fmt&lt;major&gt;.&lt;minor&gt;</span></code>, where <code class="docutils literal notranslate"><span class="pre">&lt;major&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;minor&gt;</span></code> are the major
and minor message format version. See the <code class="docutils literal notranslate"><span class="pre">FMT_VERSION_*</span></code> macros in the
generated RabbitMQ header for the numbers to use. At the time of this
writing, it is <code class="docutils literal notranslate"><span class="pre">smedl-fmt2.0</span></code>.</p>
</dd>
</dl>
<p>SMEDL uses JSON-formatted messages to encode events. Here is an example event
message:</p>
<div class="highlight-JSON notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;event&quot;</span><span class="p">:</span> <span class="s2">&quot;FooMonitor.bar&quot;</span><span class="p">,</span>
    <span class="nt">&quot;identities&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span>
    <span class="nt">&quot;params&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;baz&quot;</span><span class="p">,</span> <span class="mf">123.456</span><span class="p">],</span>
    <span class="nt">&quot;aux&quot;</span><span class="p">:</span> <span class="kc">null</span>
<span class="p">}</span>
</pre></div>
</div>
<p>These are the keys:</p>
<dl class="simple">
<dt>“event”</dt><dd><p>Optional and for human reference only, but for SMEDL-generated events, it
will be <code class="docutils literal notranslate"><span class="pre">&quot;&lt;monitor&gt;.&lt;event&gt;&quot;</span></code>. For PEDL events generated by the target
system, <code class="docutils literal notranslate"><span class="pre">&quot;&lt;event&gt;&quot;</span></code> is recommended.</p>
</dd>
<dt>“identities”</dt><dd><p>An array of the source monitor’s identities. Should be omitted for PEDL
events from the target system.</p>
</dd>
<dt>“params”</dt><dd><p>An array of the source event’s parameters.</p>
</dd>
<dt>“aux”</dt><dd><p>May be set to any valid JSON data. If not needed, it should be set to null.</p>
</dd>
</dl>
<p>For the identities and params arrays, here is how the various SMEDL types are
represented in JSON:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 14%" />
<col style="width: 86%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>SMEDL Type</p></th>
<th class="head"><p>JSON Representation</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">int</span></code></p></td>
<td><p>Number</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">char</span></code></p></td>
<td><p>Number</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">float</span></code></p></td>
<td><p>Number</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">string</span></code></p></td>
<td><p>String</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">pointer</span></code></p></td>
<td><p>String (by converting to <code class="docutils literal notranslate"><span class="pre">uintptr_t</span></code> and then rendering that in
hexadecimal)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">opaque</span></code></p></td>
<td><p>String</p></td>
</tr>
</tbody>
</table>
</section>
</section>


          </div>
              <div class="related bottom">
                &nbsp;
  <nav id="rellinks">
    <ul>
        <li>
          &larr;
          <a href="api.html" title="Previous document">Essential API</a>
        </li>
        <li>
          <a href="ros.html" title="Next document">ROS Transport</a>
          &rarr;
        </li>
    </ul>
  </nav>
              </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy; 2021 The Trustees of the University of Pennsylvania.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.0.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/api/rabbitmq.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>